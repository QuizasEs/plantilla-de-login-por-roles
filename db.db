-- ================================================
-- Script completo de base de datos - Sistema de Ventas
-- Compatible con MySQL 8+ / phpMyAdmin
-- ================================================

CREATE DATABASE IF NOT EXISTS sistema_ventas
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_general_ci;

USE sistema_ventas;

-- ================================================
-- Tabla: Roles
-- ================================================
CREATE TABLE rol (
  id_rol INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO rol (nombre) VALUES 
('Administrador'),
('Gerente'),
('Vendedor');

-- ================================================
-- Tabla: Usuarios
-- ================================================
CREATE TABLE usuario (
  id_usuario INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  usuario VARCHAR(50) UNIQUE NOT NULL,
  contrasena VARCHAR(255) NOT NULL,
  id_rol INT NOT NULL,
  FOREIGN KEY (id_rol) REFERENCES rol(id_rol)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO usuario (nombre, usuario, contrasena, id_rol) VALUES
('Carlos Pérez', 'cperez', '1234', 1),
('María Gómez', 'mgomez', '1234', 2),
('Juan López', 'jlopez', '1234', 3);

-- ================================================
-- Tabla: Categorías
-- ================================================
CREATE TABLE categoria (
  id_categoria INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  descripcion VARCHAR(255)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO categoria (nombre, descripcion) VALUES
('Bebidas', 'Productos líquidos para consumo.'),
('Snacks', 'Botanas, galletas y golosinas.'),
('Lácteos', 'Productos derivados de la leche.');

-- ================================================
-- Tabla: Marcas
-- ================================================
CREATE TABLE marca (
  id_marca INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO marca (nombre) VALUES
('Coca-Cola'),
('Nestlé'),
('Frito Lay');

-- ================================================
-- Tabla: Productos
-- ================================================
CREATE TABLE producto (
  id_producto INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  precio DECIMAL(10,2) NOT NULL,
  stock INT NOT NULL,
  id_categoria INT NOT NULL,
  id_marca INT NOT NULL,
  FOREIGN KEY (id_categoria) REFERENCES categoria(id_categoria),
  FOREIGN KEY (id_marca) REFERENCES marca(id_marca)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO producto (nombre, precio, stock, id_categoria, id_marca) VALUES
('Coca-Cola 600ml', 6.50, 100, 1, 1),
('Galletas Oreo', 4.20, 50, 2, 2),
('Leche entera 1L', 8.00, 75, 3, 2),
('Papas Lay’s 150g', 7.50, 60, 2, 3);

-- ================================================
-- Tabla: Clientes
-- ================================================
CREATE TABLE cliente (
  id_cliente INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  telefono VARCHAR(20),
  correo VARCHAR(100)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO cliente (nombre, telefono, correo) VALUES
('Luis Fernández', '78965412', 'luis.fernandez@example.com'),
('Ana Torres', '71548963', 'ana.torres@example.com'),
('Pedro Ramírez', '70125698', 'pedro.ramirez@example.com');

-- ================================================
-- Tabla: Ventas
-- ================================================
CREATE TABLE venta (
  id_venta INT AUTO_INCREMENT PRIMARY KEY,
  fecha DATETIME DEFAULT CURRENT_TIMESTAMP,
  total DECIMAL(10,2),
  id_cliente INT,
  id_usuario INT,
  FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente),
  FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO venta (fecha, total, id_cliente, id_usuario) VALUES
(NOW(), 26.50, 1, 3),
(NOW(), 15.00, 2, 3);

-- ================================================
-- Tabla: Detalle de Ventas
-- ================================================
CREATE TABLE detalle_venta (
  id_detalle INT AUTO_INCREMENT PRIMARY KEY,
  id_venta INT NOT NULL,
  id_producto INT NOT NULL,
  cantidad INT NOT NULL,
  subtotal DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (id_venta) REFERENCES venta(id_venta) ON DELETE CASCADE,
  FOREIGN KEY (id_producto) REFERENCES producto(id_producto)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO detalle_venta (id_venta, id_producto, cantidad, subtotal) VALUES
(1, 1, 2, 13.00),
(1, 4, 1, 7.50),
(2, 2, 1, 4.20),
(2, 3, 1, 8.00);

-- ================================================
-- Verificación rápida de integridad
-- ================================================
-- SELECT * FROM venta 
-- INNER JOIN cliente USING(id_cliente)
-- INNER JOIN detalle_venta USING(id_venta);

-- Fin del script
-- ================================================
